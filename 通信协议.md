**服务器IP：59.66.141.33:28888**，采用 `http` 通信。



###### `/user/login`：登录，根据用户名查找用户，并验证是否与密码匹配，成功会更新ip：

- 请求方法：`POST`
- 请求参数：`body` 中带有 `{username, password}`
- 响应：
  - 200：成功，返回 `{token}`
  - 401：`密码错误`
  - 404：`该用户不存在`

###### `/user/register`：注册，输入用户名与密码，会检测是否有重名用户，成功会更新ip：

- 请求方法：`POST`
- 请求参数：`body` 中带有 `{username, password}`
- 响应：
  - 201：成功，返回 `{token}`
  - 409：`该用户已存在`

###### `/user/change_password`：修改密码，修改 username 对应用户的密码，可由用户自己修改或管理员修改：

- 请求方法：`PUT`
- 请求参数：`body` 中带有 `{username, password}`，同时带有 token，`username` 需与 token 匹配，或用户为管理员。
- 响应：
  - 200：`密码修改成功`
  - 403：无权限，`密码修改失败`

###### `/user/change_room_id`：修改房间号，仅管理员操作：

- 请求方法：`PUT`
- 请求参数：`body` 中带有 `{username, room_id}`，同时带有管理员的 token
- 响应：
  - 200：`房间号修改成功`
  - 404：`该用户不存在`
  - 403：`房间号修改失败`

###### `/ip/update`：主动请求更新ip地址，根据token确认身份：

- 请求方法：`PUT`
- 请求参数：无，但要求 `Authorization` 中带有 `Bearer Token`，即登录或注册时响应的token。
- 响应：
  - 200：`更新成功`
  - 401：token无效，`401 Unauthorized: Missing token` 或 `401 Unauthorized: Invalid token`
  - 500：`更新失败`

###### `/order/create`：创建新订单

- 请求方法：`POST`
- 请求参数：`{room_start: string, room_end: string, door: number, code: string}`，door为`0,1,2`中任一数字，code为六位取件码，room_start和room_end为起止房间号。需 token
- 响应：
  - 201：`订单创建成功`

###### `/order/list/my_order`：查看自己创建的订单

- 请求方法：`GET`

- 请求参数：无，需带 token

- 响应：

  - 200：一个Array，每个元素为一个订单object，如：

    ```
    [
        {
            "_id": "65f02a747b659a2b5206f03c",
            "room_start": "B569",
            "room_end": "B999",
            "door": 2,
            "code": "002591",
            "time_start": "2024-03-12 18:12:04",
            "time_end": "",
            "user_order": "xmy",
            "status": "pending"
        },
        ...
    ]
    ```

    

###### `/order/list/my_item`：查看送往自己房间的订单

- 请求方法：`GET`
- 请求参数：无，需带 token
- 响应：
  - 200：一个Array，每个元素为一个订单object，同`/order/list/my_order`。

###### `/order/list/all`：查看所有订单，管理员操作

- 请求方法：`GET`
- 请求参数：无，需带管理员 token
- 响应：
  - 200：Array of order object.
  - 403：`无权查看所有订单`

###### `/order/cancel`：取消订单

- 请求方法：`POST`
- 请求参数：`body` 中带 `_id`，需 token

- 响应：
  - 200：`订单取消成功`
  - 403：`无权取消订单`
  - 404：`订单不存在`

###### `/door/status`：获取柜子状态

- 请求方法：`GET`

- 请求参数：无

- 响应：包含3个object的Array，每个object对应一个柜门，`{status: string, queue: number}` 
  status包含4个状态：`pending待放货，running送去/returning送回/failed无人领取`，`queue`表示队列人数。当 `queue==0` 时表示该柜子为空闲状态，没有订单指定该柜子。